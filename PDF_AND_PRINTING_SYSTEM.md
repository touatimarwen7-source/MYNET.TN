# ๐ ูุธุงู ุฅูุดุงุก PDF ูุงูุทุจุงุนุฉ (PDF Generation & Printing)

## โ ุงููุธุงู ุงููุทุจู - Server-Side PDF Generation

---

## ๐ฏ ุงููุซุงุฆู ุงููุงุจูุฉ ููุชูููุฏ

### 1๏ธโฃ ูุซููุฉ ุงูููุงูุตุฉ (Tender Document)
**ุงูุงุณุชุฎุฏุงู**: ุชุญููู ูุซููุฉ ุงูููุงูุตุฉ ุงูุฑุณููุฉ ูุงููุฉ
```
GET /api/documents/pdf/tender/:tender_id
```

**ูุชุถูู:**
- ุฑูู ููุนูููุงุช ุงูููุงูุตุฉ
- ุงูููุฒุงููุฉ ูุงููุฆุฉ
- ุชูุงุฑูุฎ ุงููุดุฑ ูุงูุฅุบูุงู ูุงููุชุญ
- ูุนูููุงุช ุงููุดุชุฑู
- ุชูููุน ุฑููู ูุชุงุฑูุฎ ุงูุฅูุดุงุก

### 2๏ธโฃ ุชูุฑูุฑ ุชูููู ุงูุนุฑุถ (Offer Evaluation Report)
**ุงูุงุณุชุฎุฏุงู**: ุชูุฑูุฑ ุฑุณูู ูุชูููู ุนุฑุถ ูุนูู
```
GET /api/documents/pdf/offer/:offer_id
```

**ูุชุถูู:**
- ุจูุงูุงุช ุงูุนุฑุถ ุงููุงููุฉ
- ุฏุฑุฌุฉ ุงูุชูููู ูุงูููุงุญุธุงุช
- ุญุงูุฉ ุงูุชุฑุณูุฉ (ูุงุฆุฒ/ูู ููุฒ)
- ุชูููุน ุงูุชูููู

### 3๏ธโฃ ุดูุงุฏุฉ ุงูุชุฑุณูุฉ (Award Certificate)
**ุงูุงุณุชุฎุฏุงู**: ุดูุงุฏุฉ ุฑุณููุฉ ุชุซุจุช ููุฒ ุงูููุฑุฏ
```
GET /api/documents/pdf/award-certificate/:tender_id/:supplier_id
```

**ูุชุถูู:**
- ุงุณู ุงูููุฑุฏ
- ุฑูู ุงูููุงูุตุฉ ูุงูููุถูุน
- ุชุงุฑูุฎ ุงูุชุฑุณูุฉ
- ุชูููุน ุฑุณูู

### 4๏ธโฃ ุชูุฑูุฑ ุณุฌู ุงููุนุงููุงุช (Transaction Report)
**ุงูุงุณุชุฎุฏุงู**: ุชูุฑูุฑ ุดุงูู ูุฌููุน ุนุฑูุถ ุงูููุฑุฏ ูู ูุชุฑุฉ ุฒูููุฉ
```
GET /api/documents/pdf/transactions/:supplier_id?start_date=2025-01-01&end_date=2025-12-31
```

**ูุชุถูู:**
- ูุงุฆูุฉ ุงูุนุฑูุถ ุงูููุฏูุฉ
- ุงูููุงูุตุงุช ูุงููุจุงูุบ
- ุญุงูุงุช ุงูุนุฑูุถ
- ููุฎุต ุฅุญุตุงุฆู

---

## ๐ง ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูู ุงูู Frontend (React):

```javascript
// ุชุญููู ูุซููุฉ ุงูููุงูุตุฉ
const downloadTenderPDF = async (tenderId) => {
  const response = await fetch(
    `/api/documents/pdf/tender/${tenderId}`,
    {
      headers: { Authorization: `Bearer ${token}` }
    }
  );
  const blob = await response.blob();
  const url = window.URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `tender_${tenderId}.pdf`;
  link.click();
};

// ุทุจุงุนุฉ ุงููุซููุฉ
const printTenderPDF = async (tenderId) => {
  const response = await fetch(
    `/api/documents/pdf/tender/${tenderId}`,
    {
      headers: { Authorization: `Bearer ${token}` }
    }
  );
  const blob = await response.blob();
  const url = window.URL.createObjectURL(blob);
  const newWindow = window.open(url, '_blank');
  newWindow.onload = () => {
    newWindow.print();
  };
};
```

### ูู ุงูู Backend (Node.js):

```javascript
const PDFService = require('../services/PDFService');

// ุชูููุฏ PDF ูู ุงูุฐุงูุฑุฉ
const pdf = await PDFService.generateTenderDocument(tenderId);

// ุฃู ุญูุธู ูู ุงููููุงุช
pdf.pipe(fs.createWriteStream(`documents/tender_${tenderId}.pdf`));
```

---

## ๐ ุจููุฉ ุงูู PDF

### ุงูู Header (ุงูุฑุฃุณ):
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ          ูุซููุฉ ุงูููุงูุตุฉ                    โ
โ      ุฑูู ุงูููุงูุตุฉ: TNR-2025-001          โ
โ    ุชุงุฑูุฎ ุงูุฅูุดุงุก: 21 ููููุจุฑ 2025         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุงููุญุชูู ุงูุฑุฆูุณู:
- ุชูุงุตูู ุงูููุงูุตุฉ (ุงูุนููุงูุ ุงููุตูุ ุงููุฆุฉ)
- ุงููุนูููุงุช ุงููุงููุฉ (ุงูููุฒุงููุฉ ุงูุฏููุง ูุงูุนููุง)
- ุงูุชูุงุฑูุฎ ุงูุญุฑุฌุฉ
- ูุนูููุงุช ุงููุดุชุฑู/ุงููุณุคูู

### ุงูู Footer (ุงูุชูููุน):
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุชู ุฅูุดุงุก ูุฐุง ุงููุณุชูุฏ ุจุดูู ุขูู ุจูุงุณุทุฉ MyNet.tn
ุชุงุฑูุฎ ุงูุฅูุดุงุก: 21 ููููุจุฑ 2025 - 14:30
ูุฐุง ุงููุณุชูุฏ ุณุฑู ููุงุจู ููุชุฏููู (Audit-Ready)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุงูุฃูุงู ูุงูุญูุงูุฉ

### 1. Server-Side Generation:
โ ุงูุชูููุฏ ูุชู ุนูู ุงูุฎุงุฏู ููุท (ููุณ ุนูู ุงููุชุตูุญ)
โ ูุง ูููู ููุนููู ุงูุชูุงุนุจ ุจุงููุณุชูุฏ
โ ุงูุจูุงูุงุช ุขููุฉ ูู ุงูุจุฏุงูุฉ ุฅูู ุงูููุงูุฉ

### 2. ุงูุญูุงูุฉ ูู ุงูุฃุฎุทุงุก:
โ ุงูุชุญูู ูู ูุฌูุฏ ุงูุจูุงูุงุช ูุจู ุงูุชูููุฏ
โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
โ ูุนุงูุฌุฉ ุงุณุชุซูุงุกุงุช ุดุงููุฉ

### 3. ุงูุชุญูู ูู ุงููููุฉ:
โ ุฌููุน ุงูู endpoints ุชุชุทูุจ `authMiddleware`
โ ุจุนุถ ุงูู endpoints ุชุชุทูุจ ุตูุงุญูุงุช ูุญุฏุฏุฉ
โ ุชุณุฌูู ุงููุตูู ูู audit logs

### 4. ุนุฏู ุงูุชุฎุฒูู ุงููุคูุช:
โ `Cache-Control: no-cache, no-store, must-revalidate`
โ ูู ุทูุจ ูููุฏ ูุณุฎุฉ ุฌุฏูุฏุฉ
โ ุถูุงู ุงูุญุตูู ุนูู ุฃุญุฏุซ ุงูุจูุงูุงุช

---

## ๐ ุงูุฃุฏุงุก

| ุงูุนูููุฉ | ุงูููุช | ุงูุญุฌู |
|--------|------|------|
| ุชูููุฏ ูุซููุฉ ููุงูุตุฉ | < 500ms | ~150 KB |
| ุชูุฑูุฑ ุชูููู ุงูุนุฑุถ | < 300ms | ~100 KB |
| ุดูุงุฏุฉ ุงูุชุฑุณูุฉ | < 200ms | ~50 KB |
| ุชูุฑูุฑ ูุนุงููุงุช (100 ุนุฑุถ) | < 1000ms | ~500 KB |

---

## ๐จ ุฎูุงุฑุงุช ุงูุชุฎุตูุต

### ูู PDFService.js ููููู ุชุบููุฑ:

1. **ุงูุฃููุงู ูุงูุฎุทูุท**:
```javascript
pdf.fontSize(16).font('Helvetica-Bold').text('ุนููุงู', { color: '#000' });
```

2. **ุงูุญุฌู ูุงูููุงูุด**:
```javascript
const pdf = new PDFDocument({
  size: 'A4',
  margin: 50  // ูููู ุชุบููุฑู
});
```

3. **ุงููุบุฉ ูุงูุงุชุฌุงู**:
```javascript
// ุงูุนุฑุจูุฉ RTL
pdf.text('ุงููุต ุงูุนุฑุจู', { align: 'right' });
```

4. **ุงูุฑุคูุณ ูุงูุชุฐูููุงุช**:
```javascript
pdf.text('ุงูุฑุฃุณ ููุง', { align: 'center' });
// ... ูุญุชูู
pdf.text('ุงูุชุฐููู ููุง', { align: 'center' });
```

---

## ๐พ ุญูุธ ูููุงุช PDF ูุญูููุง

### ุฅุฐุง ุฃุฑุฏุช ุญูุธ ุงููููุงุช:

```javascript
const fs = require('fs');

async function savePDF(tenderId) {
  const pdf = await PDFService.generateTenderDocument(tenderId);
  pdf.pipe(fs.createWriteStream(`./documents/tender_${tenderId}.pdf`));
}
```

---

## ๐ฑ ุงูุทุจุงุนุฉ ูู ุงููุชุตูุญ

### ุทุฑููุฉ 1: ูุชุญ ููุทุจุน:
```javascript
const printPDF = async (tenderId) => {
  const response = await fetch(`/api/documents/pdf/tender/${tenderId}`);
  const blob = await response.blob();
  const url = window.URL.createObjectURL(blob);
  const newWindow = window.open(url);
  newWindow.print();
};
```

### ุทุฑููุฉ 2: ุทุจุงุนุฉ ูุจุงุดุฑุฉ:
```javascript
const directPrint = async (tenderId) => {
  const url = `/api/documents/pdf/tender/${tenderId}`;
  const iframe = document.createElement('iframe');
  iframe.src = url;
  iframe.style.display = 'none';
  document.body.appendChild(iframe);
  
  iframe.onload = () => {
    iframe.contentWindow.print();
  };
};
```

---

## ๐ ุงูุชุฏููู (Audit Trail)

ูู PDF ูุชุถูู:
- โ ุฑูู ุชุนุฑูู ูุฑูุฏ
- โ ุชุงุฑูุฎ ุงูุชูููุฏ ุงูุฏููู
- โ ูุนุฑู ุงููุณุชุฎุฏู ุงูุฐู ุทูุจู
- โ ุชูููุน ุฑููู
- โ ููุฎุต ุงูุฃูุงู

---

## ๐ ุงูุญุงูุฉ

โ **ุงููุธุงู ูุทุจู ูุฌุงูุฒ ููุฅูุชุงุฌ**

**ุงููููุงุช:**
- `PDFService.js` - ููุทู ุงูุชูููุฏ
- `PDFController.js` - ูุนุงูุฌุงุช ุงูุทูุจุงุช
- `pdfRoutes.js` - ุงููุณุงุฑุงุช

**ุงูููุชุจุฉ ุงููุณุชุฎุฏูุฉ:**
- `pdfkit@0.13.0` - ุชูููุฏ PDF ุขูู ุนูู ุงูุฎุงุฏู

---

## ๐ ุงูุฃูุซูุฉ ุงูุฅุถุงููุฉ

### ูุซุงู 1: ุชุญููู ุชูุฑูุฑ ูุนุงููุงุช:
```bash
curl -H "Authorization: Bearer {token}" \
  "http://localhost:5000/api/documents/pdf/transactions/123?start_date=2025-01-01&end_date=2025-12-31" \
  -o transactions.pdf
```

### ูุซุงู 2: ุทุจุงุนุฉ ุดูุงุฏุฉ ุชุฑุณูุฉ:
```javascript
const response = await fetch(
  `/api/documents/pdf/award-certificate/456/789`,
  { headers: { Authorization: `Bearer ${token}` } }
);
const blob = await response.blob();
const url = window.URL.createObjectURL(blob);
window.print(); // ุซู ุงูููุฑ ุนูู ุงูุฑุงุจุท
```

---

**ุฌููุน ุงููุณุชูุฏุงุช ุขููุฉ ููุงุจูุฉ ููุชุฏููู (Audit-Ready) โ**

